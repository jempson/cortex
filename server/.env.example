# Cortex Server Configuration
# Copy this to .env and customize for your deployment

# Server port (default: 3001)
PORT=3001

# JWT secret key - CHANGE THIS IN PRODUCTION!
# Generate with: node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
JWT_SECRET=your-super-secret-key-change-me-in-production

# JWT expiration (default: 24h for security)
# Users can choose longer durations (7d, 30d) at login for convenience
# Valid values: 24h, 7d, 30d
JWT_EXPIRES_IN=24h

# Allowed CORS origins (comma-separated)
# Leave empty to allow all origins (development only!)
# Example: https://cortex.yourdomain.com,https://www.yourdomain.com
ALLOWED_ORIGINS=

# Seed demo data on first run (default: false)
# Set to 'true' to create demo users (mal, zoe, etc.) with password Demo123!
# Only applies when cortex-data.json doesn't exist yet
SEED_DEMO_DATA=false

# Use SQLite database instead of JSON files (recommended for production)
# USE_SQLITE=true

# =============================================================================
# Push Notifications (VAPID)
# =============================================================================
# Push notifications require VAPID (Voluntary Application Server Identification)
# keys. Without these, push notifications will be disabled (501 error).
#
# Generate VAPID keys by running this command in the server directory:
#   node -e "const wp = require('web-push'); const k = wp.generateVAPIDKeys(); console.log('VAPID_PUBLIC_KEY=' + k.publicKey + '\nVAPID_PRIVATE_KEY=' + k.privateKey);"
#
# IMPORTANT:
# - Generate keys ONCE and keep them forever - changing keys invalidates all
#   existing push subscriptions
# - Keep VAPID_PRIVATE_KEY secret - never commit it to version control
# - VAPID_EMAIL should be a valid contact email (mailto: prefix required)
#
# VAPID_PUBLIC_KEY=your-public-key-here
# VAPID_PRIVATE_KEY=your-private-key-here
# VAPID_EMAIL=mailto:admin@yourdomain.com

# =============================================================================
# GIF Search Integration
# =============================================================================
# Cortex supports both GIPHY and Tenor for GIF search.
# Configure one or both providers. Use GIF_PROVIDER to choose which to use.
#
# GIPHY - Get a free API key at https://developers.giphy.com/
# GIPHY_API_KEY=your-giphy-api-key
#
# TENOR - Get a free API key at https://developers.google.com/tenor/guides/quickstart
# (Tenor is part of Google, uses Google Cloud Console for API key)
# TENOR_API_KEY=your-tenor-api-key
#
# GIF_PROVIDER options:
#   'giphy'  - Use GIPHY only (default)
#   'tenor'  - Use Tenor only
#   'both'   - Use both providers, results interleaved
# GIF_PROVIDER=giphy

# =============================================================================
# Rate Limiting Configuration
# =============================================================================
# Increase these values for development/testing to avoid lockouts
# Defaults shown - uncomment and adjust as needed

# Max login attempts per 15 minutes (default: 30)
# RATE_LIMIT_LOGIN_MAX=30

# Max registration attempts per hour (default: 15)
# RATE_LIMIT_REGISTER_MAX=15

# Max API requests per minute (default: 300)
# RATE_LIMIT_API_MAX=300

# Max GIF searches per minute (default: 30)
# RATE_LIMIT_GIF_MAX=30

# Account lockout threshold - failed attempts before lockout (default: 15)
# LOCKOUT_THRESHOLD=15

# Account lockout duration in minutes (default: 15)
# LOCKOUT_DURATION_MINUTES=15

# =============================================================================
# Federation (v1.13.0)
# =============================================================================
# Federation enables server-to-server communication for cross-instance waves.
# When enabled, users can participate in waves hosted on other Cortex servers.
#
# IMPORTANT:
# - FEDERATION_NODE_NAME should be your server's public hostname
# - Federation uses RSA keypairs for server authentication (auto-generated)
# - Trust is manual - admins must explicitly add trusted federation partners
#
# Enable federation (default: false)
# FEDERATION_ENABLED=false
#
# Your server's federation hostname (required if federation enabled)
# This should match how other servers will connect to you
# FEDERATION_NODE_NAME=cortex.example.com

# =============================================================================
# Email Service (v1.14.0)
# =============================================================================
# Email is required for password reset and email MFA features.
# Without email configured, these features will return errors.
#
# EMAIL_PROVIDER=smtp  # smtp, sendgrid, or mailgun
#
# SMTP Configuration:
# SMTP_HOST=smtp.example.com
# SMTP_PORT=587
# SMTP_USER=your-username
# SMTP_PASS=your-password
# EMAIL_FROM=noreply@yourdomain.com
#
# SendGrid Configuration:
# EMAIL_PROVIDER=sendgrid
# SENDGRID_API_KEY=SG.xxx
# EMAIL_FROM=noreply@yourdomain.com
#
# Mailgun Configuration:
# EMAIL_PROVIDER=mailgun
# MAILGUN_API_KEY=xxx
# MAILGUN_DOMAIN=mg.yourdomain.com
# EMAIL_FROM=noreply@yourdomain.com

# =============================================================================
# Database Encryption (v1.14.0)
# =============================================================================
# Optional encryption at rest using SQLCipher.
# Requires @journeyapps/sqlcipher instead of better-sqlite3.
#
# DB_ENCRYPTION_KEY=your-32-byte-hex-key

# =============================================================================
# Crawl Bar - External Data Sources (v1.15.0)
# =============================================================================
# The crawl bar displays stocks, weather, and news in a scrolling ticker.
# Multiple providers can be configured - they will be used as fallbacks.
# Without any keys for a category, that section will be hidden.
#
# -----------------------------------------------------------------------------
# STOCK DATA
# -----------------------------------------------------------------------------
# FINNHUB API - Stock market data
# Get a free API key at https://finnhub.io/
# Free tier: 60 API calls/minute
# FINNHUB_API_KEY=your-finnhub-api-key
#
# -----------------------------------------------------------------------------
# WEATHER DATA (providers tried in order, first success wins)
# -----------------------------------------------------------------------------
# OPENWEATHERMAP API (primary) - Weather data
# Get a free API key at https://openweathermap.org/api
# Free tier: 1000 calls/day, supports weather alerts
# OPENWEATHERMAP_API_KEY=your-openweathermap-api-key
#
# WEATHERAPI.COM (fallback) - Weather data
# Get a free API key at https://www.weatherapi.com/
# Free tier: 1,000,000 calls/month
# WEATHERAPI_KEY=your-weatherapi-key
#
# TOMORROW.IO (fallback) - Weather data
# Get a free API key at https://www.tomorrow.io/
# Free tier: 500 calls/day
# TOMORROWIO_API_KEY=your-tomorrowio-api-key
#
# -----------------------------------------------------------------------------
# NEWS DATA (all configured providers are used, results combined)
# -----------------------------------------------------------------------------
# NEWSAPI.ORG - News headlines
# Get a free API key at https://newsapi.org/
# Free tier: 100 requests/day (dev only, localhost)
# NEWSAPI_KEY=your-newsapi-key
#
# GNEWS.IO - News headlines
# Get a free API key at https://gnews.io/
# Free tier: 100 requests/day
# GNEWS_API_KEY=your-gnews-api-key
#
# MEDIASTACK - News headlines
# Get a free API key at https://mediastack.com/
# Free tier: 500 requests/month
# MEDIASTACK_API_KEY=your-mediastack-api-key
#
# RSS FEEDS - Custom news sources (comma-separated URLs)
# Add your favorite RSS/Atom feeds for news headlines
# Example: NEWS_RSS_FEEDS=https://feeds.bbci.co.uk/news/rss.xml,https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml
# NEWS_RSS_FEEDS=
#
# -----------------------------------------------------------------------------
# GEOLOCATION
# -----------------------------------------------------------------------------
# IPINFO.IO - Enhanced IP geolocation (optional)
# Using ip-api.com by default (free, no key needed)
# For higher limits, get a token at https://ipinfo.io/
# IPINFO_TOKEN=your-ipinfo-token
#
# Crawl bar rate limiting (requests per minute)
# RATE_LIMIT_CRAWL_MAX=60

# =============================================================================
# Production Bot Integration (v2.1.0)
# =============================================================================
# Configuration for posting release updates to production Cortex
# Used by development environment to announce updates to production users
#
# CORTEX_PROD_URL - Production Cortex server URL
# CORTEX_PROD_URL=https://cortex.example.com
#
# CORTEX_PROD_BOT_KEY - Bot API key from production (starts with fh_bot_)
# Get this from production admin panel: Admin → Bots → Create Bot
# CORTEX_PROD_BOT_KEY=fh_bot_your-key-here
#
# CORTEX_DEV_BOT_KEY - Bot API key for development/testing
# CORTEX_DEV_BOT_KEY=fh_bot_your-dev-key-here
#
# CORTEX_PROD_UPDATES_WAVE_ID - Wave ID for Cortex Updates
# Get this by viewing the wave in production and copying the ID
# CORTEX_PROD_UPDATES_WAVE_ID=your-wave-id-here
#
# Bot API Usage:
# POST https://cortex.example.com/api/bot/ping
#   Headers: Authorization: Bearer fh_bot_xxxxx
#   Body: {"waveId": "wave-id", "content": "message"}
#
# Or use webhooks (no auth needed):
# POST https://cortex.example.com/api/webhooks/bot-{id}/{secret}
#   Body: {"waveId": "wave-id", "content": "message"}

# =============================================================================
# SSH Deployment Configuration (v2.5.0)
# =============================================================================
# SSH hostnames for direct server access (requires SSH keys configured)
# Used by Claude Code for automated deployments
#
# CORTEX_PROD_SERVER - Production server SSH hostname
# Configure in ~/.ssh/config with hostname, user, and key
# CORTEX_PROD_SERVER=cortex-prod
#
# CORTEX_QA_SERVER - QA/Staging server SSH hostname
# CORTEX_QA_SERVER=cortex-qa
#
# Example ~/.ssh/config:
#   Host cortex-prod
#     HostName your-prod-server.com
#     User jempson
#     IdentityFile ~/.ssh/cortex_prod_key
#
# Common deployment commands:
#   ssh cortex-prod "cd /home/jempson/cortex && git pull && cd client && npm run build && pm2 restart cortex-api"
#   ssh cortex-prod "cd /home/jempson/cortex && pm2 status"
#   ssh cortex-prod "cd /home/jempson/cortex && pm2 logs cortex-api --lines 50"

# =============================================================================
# Object Storage (v2.13.0)
# =============================================================================
# By default, Cortex stores uploaded files on the local filesystem.
# For large files (videos, etc.) or distributed deployments, use S3-compatible
# object storage like MinIO, AWS S3, Backblaze B2, or Cloudflare R2.
#
# STORAGE_PROVIDER=local  # 'local' (default) or 's3'
#
# S3-compatible storage settings (required when STORAGE_PROVIDER=s3):
# Works with MinIO, AWS S3, Backblaze B2, Cloudflare R2, and others.
#
# S3_ENDPOINT=http://localhost:9000          # MinIO endpoint
# S3_ENDPOINT=https://s3.amazonaws.com       # AWS S3
# S3_ENDPOINT=https://s3.us-west-000.backblazeb2.com  # Backblaze B2
#
# S3_BUCKET=cortex-media                     # Bucket name
# S3_ACCESS_KEY=your-access-key              # Access key ID
# S3_SECRET_KEY=your-secret-key              # Secret access key
# S3_REGION=us-east-1                        # Region (default: us-east-1)
#
# Optional: Public URL for accessing files (if using CDN or custom domain)
# If not set, files are served via S3_ENDPOINT
# S3_PUBLIC_URL=https://cdn.example.com
#
# Upload limits when using S3 storage (can be higher than local):
# S3_MAX_FILE_SIZE_MB=5000                   # 5GB max file size
# S3_MAX_VIDEO_DURATION_SEC=0                # 0 = unlimited duration
#
# MinIO Quick Setup:
#   docker run -p 9000:9000 -p 9001:9001 \
#     -e MINIO_ROOT_USER=admin \
#     -e MINIO_ROOT_PASSWORD=password123 \
#     -v ~/minio/data:/data \
#     minio/minio server /data --console-address ":9001"
#
#   Then create a bucket named 'cortex-media' in the MinIO console (localhost:9001)

# =============================================================================
# Jellyfin Integration (v2.14.0)
# =============================================================================
# Jellyfin integration enables users to:
# - Connect their personal Jellyfin media servers
# - Browse and share media in waves
# - Host synchronized watch parties
# - Import personal videos to the video feed
#
# No server-level configuration needed - users add their own Jellyfin servers.
# The following optional settings control rate limiting and behavior.
#
# Max Jellyfin API requests per minute (default: 60)
# RATE_LIMIT_JELLYFIN_MAX=60

# =============================================================================
# Security & Privacy (v1.18.0)
# =============================================================================
# HTTPS Enforcement
# When enabled, HTTP requests are redirected to HTTPS in production.
# Requires a reverse proxy (nginx, Caddy) to handle SSL termination.
# ENFORCE_HTTPS=true

# CORS Strict Mode (default: true)
# When true, ALLOWED_ORIGINS must be set in production.
# Set to false in development to allow all origins.
# CORS_STRICT_MODE=true

# Session Tracking (default: true)
# When enabled, login sessions are tracked in the database and can be revoked.
# Users can view and manage their active sessions in Profile Settings.
# SESSION_TRACKING_ENABLED=true
